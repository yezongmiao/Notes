
# H265说明
- [H265说明](#h265说明)
  - [1.1 YUV格式情况](#11-yuv格式情况)
    - [1.1.1 YUV整体理解](#111-yuv整体理解)
    - [1.1.2 YUV采样格式](#112-yuv采样格式)
    - [1.1.3 YUV存储格式](#113-yuv存储格式)

## 1.1 YUV格式情况
### 1.1.1 YUV整体理解
[YUV_简书](https://www.jianshu.com/p/6a361e86ccd5)

yuv种类分为很多，可以理解是一个**二维的**，即空间间，和空间内，这样的表述，借鉴了h264中的帧间和帧内的思想。

**空间-内**：不同空间，即描述一个像素的bit数不同，比如yuv444，yuv422，yuv411，yuv420

**空间-间**：相同空间，即描述一个像素的bit数相同，但是存储方式不同，比如对于yuv420而言，又可细分为yuv420p，yuv420sp，nv21，nv12，yv12，yu12，I420

### 1.1.2 YUV采样格式

从空间的角度考虑YUV格式：

YUV 444  最完整的最理想的状态

      [ y u v ] [ y u v ] [ y u v ] [ y u v ]
      [ y u v ] [ y u v ] [ y u v ] [ y u v ]
      [ y u v ] [ y u v ] [ y u v ] [ y u v ]
      [ y u v ] [ y u v ] [ y u v ] [ y u v ]

YUV 422格式，在原来满的情况下，每行需要去掉两个u和两个v

      [ y u ] [ y v ] [ y u ] [ y v ]
      [ y v ] [ y u ] [ y v ] [ y u ]
      [ y u ] [ y v ] [ y u ] [ y v ]
      [ y v ] [ y u ] [ y v ] [ y u ]


YUV 411格式，原来yuv422的基础上，每行再去掉一个u和一个v

      [ y u ] [ y ] [ y v ] [ y ]
      [ y u ] [ y ] [ y v ] [ y ]
      [ y u ] [ y ] [ y v ] [ y ]
      [ y u ] [ y ] [ y v ] [ y ]

4. YUV 420格式，原来yuv422的基础上，拿掉两个v或者U，其实yuv420的取名方式不是很高明，**更确切的命名为yuv420yuv402**也就是第一行只有两个u，而第二行只有两个v

      [ y u ] [ y ] [ y u ] [ y ]
      [ y v ] [ y ] [ y v ] [ y ]
      [ y u ] [ y ] [ y u ] [ y ]

### 1.1.3 YUV存储格式

三种格式packet，planar，semi-plane

**packet**: 是打包格式，即存储yuv，然后再存储下一个yuv ..
**planar**是平面格式，即先存储y平面，再存储u平面，最后存储v平面(好像都是这种的)
**semi-planar**是两个平面，正常的planar是三个平面，即y平面，u平面，v平面，现在的semi-planar是两个平面，也就是说uv为同一个平面，即一个y平面，一个uv平面

探讨一下相同bit数的不同存储格式，主要讨论yuv422和yuv420：

1.  YUV422

yuyv（yuy2）

        [ y u ] [ y v ] [ y u ] [ y v ]
        [ y u ] [ y v ] [ y u ] [ y v ]
        [ y u ] [ y v ] [ y u ] [ y v ]
        [ y u ] [ y v ] [ y u ] [ y v ]

uyvy

        [ u y ] [ v y ] [ u y ] [ v y ]
        [ u y ] [ v y ] [ u y ] [ v y ]
        [ u y ] [ v y ] [ u y ] [ v y ]
        [ u y ] [ v y ] [ u y ] [ v y ]

yuv422p（yu16）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ u u u u ]
        [ u u u u ]
        [ v v v v ]
        [ v v v v ]

（yv16）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ v v v v ]
        [ v v v v ]
        [ u u u u ]
        [ u u u u ]

yuv422sp（nv16）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ u v u v ]
        [ u v u v ]
        [ u v u v ]
        [ u v u v ]

2. yuv420

yuv420p（yu12 / I420）  **这个好像是最常用的格式，从YUV转RGB都是按照这个格式读取文件的流**

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ u u ]
        [ u u ]
        [ v v ]
        [ v v ]

或（yv12）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ v v ]
        [ v v ]
        [ u u ]
        [ u u ]

yuv420sp（nv12）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ u v u v ]
        [ u v u v ]

或（nv21）

        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ y y y y ]
        [ v u v u ]
        [ v u v u ]

## 5.1环路滤波

### 去块滤波器

[CSDN-去方块滤波](https://blog.csdn.net/Dillon2015/article/details/104385174?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-2.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-2.control)

去块滤波器模块需要针对所有的PU,和TU边界中的8x8的块边界进行处理，包括两个环节：滤波决策和滤波操作。

1. 滤波决策，得到滤波强度（不滤波，弱滤波，强滤波）和滤波参数
2. 然后根据滤波强度决策滤波开关，选择对应的滤波参数对像素进行相应的修正。

![](https://img-blog.csdnimg.cn/20200218233811320.png)

对不同的视频内容以及不同的编码参数具有自适应的功能，对平滑处的不连续边界做强滤波处理，而对纹理较为丰富的区域弱滤波或者不滤波处理。此处有一个由量化决定的滤波阈值，当纹理复杂程度超过阈值的时候，则不用滤波，否则关闭。后续在再根据纹理，进行滤波强度的选择。![](https://img-blog.csdnimg.cn/32a7512ee6554db0a2ed0c6a5ba5962b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Y-256yZ566r,size_20,color_FFFFFF,t_70,g_se,x_16)

（a）图由于边界两侧平缓，就会有很明显 的边界，而（b）处的纹理比较多，所以可能使用弱的滤波，（c）的话，由于边界两边差别过于大，这部分的差别超过了滤波可能导致的差别，所以这可能是图像的内容导致的。





